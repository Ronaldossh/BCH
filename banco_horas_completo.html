<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Banco de Horas - Completo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #34495e;
            border-bottom: 3px solid #2c3e50;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #34495e;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            border-right: 1px solid #2c3e50;
        }

        .tab:hover {
            background: #3498db;
        }

        .tab.active {
            background: #2c3e50;
            border-bottom: 3px solid #3498db;
        }

        .tab-content {
            display: none;
            padding: 20px;
            min-height: calc(100vh - 140px);
        }

        .tab-content.active {
            display: block;
        }

        /* Painel Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 5px solid #3498db;
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .card .value {
            font-size: 2.2em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 10px;
        }

        .card.positive .value {
            color: #27ae60;
        }

        .card.negative .value {
            color: #e74c3c;
        }

        /* Lançamentos Styles */
        .form-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input, .form-group select {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            background: #3498db;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        /* Relatórios Styles */
        .week-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .week-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .week-header {
            background: #3498db;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
        }

        .week-content {
            padding: 15px;
        }

        .funcionario-section {
            margin-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 15px;
        }

        .funcionario-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .funcionario-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .day-entry {
            display: grid;
            grid-template-columns: 80px 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .day-entry.header {
            background: #34495e;
            color: white;
            font-weight: bold;
        }

        .totals-section {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .total-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .total-extras {
            color: #27ae60;
            font-size: 1.2em;
            border-top: 2px solid #27ae60;
            padding-top: 10px;
            margin-top: 10px;
        }

        /* Table Styles */
        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #2c3e50;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9em;
        }

        td {
            padding: 10px 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9em;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .status-positive {
            color: #27ae60;
            font-weight: bold;
        }

        .status-negative {
            color: #e74c3c;
            font-weight: bold;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .week-container {
                grid-template-columns: 1fr;
            }
            
            .day-entry {
                grid-template-columns: 1fr;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🕐 Sistema de Banco de Horas</h1>
            <p>Controle Semanal Completo - Loja</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('painel')">📊 Painel</button>
            <button class="tab" onclick="showTab('lancamentos')">📝 Lançamentos</button>
            <button class="tab" onclick="showTab('relatorios')">📋 Relatórios</button>
        </div>

        <!-- ABA PAINEL -->
        <div id="painel" class="tab-content active">
            <div class="dashboard-grid">
                <div class="card">
                    <h3>Total Funcionários</h3>
                    <div class="value" id="totalFuncionarios">2</div>
                    <small>Ativos no sistema</small>
                </div>
                <div class="card">
                    <h3>Semana Atual</h3>
                    <div class="value" id="semanaAtual">1</div>
                    <small>de 4 semanas</small>
                </div>
                <div class="card positive">
                    <h3>Total Extras (Mês)</h3>
                    <div class="value" id="totalExtrasMes">0:00</div>
                    <small>Todos os funcionários</small>
                </div>
                <div class="card">
                    <h3>Registros Hoje</h3>
                    <div class="value" id="registrosHoje">0</div>
                    <small>Pontos lançados</small>
                </div>
            </div>

            <div class="form-section">
                <h2>📈 Resumo por Funcionário (Semana Atual)</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Funcionário</th>
                                <th>Horas Trabalhadas</th>
                                <th>Horas Extras</th>
                                <th>Atrasos</th>
                                <th>Saldo</th>
                            </tr>
                        </thead>
                        <tbody id="resumoFuncionarios">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ABA LANÇAMENTOS -->
        <div id="lancamentos" class="tab-content">
            <div class="form-section">
                <h2>📝 Registrar Ponto</h2>
                <form id="pontoForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="funcionario">Funcionário:</label>
                            <select id="funcionario" required>
                                <option value="">Selecione...</option>
                                <option value="RONALDO">RONALDO</option>
                                <option value="JANAINA">JANAINA</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="semana">Semana:</label>
                            <select id="semana" required>
                                <option value="1">Semana 1</option>
                                <option value="2">Semana 2</option>
                                <option value="3">Semana 3</option>
                                <option value="4">Semana 4</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dia">Dia da Semana:</label>
                            <select id="dia" required>
                                <option value="">Selecione...</option>
                                <option value="DOMINGO">Domingo</option>
                                <option value="SEGUNDA">Segunda-feira</option>
                                <option value="TERCA">Terça-feira</option>
                                <option value="QUARTA">Quarta-feira</option>
                                <option value="QUINTA">Quinta-feira</option>
                                <option value="SEXTA">Sexta-feira</option>
                                <option value="SABADO">Sábado</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="entrada1">Entrada 1:</label>
                            <input type="time" id="entrada1">
                        </div>
                        <div class="form-group">
                            <label for="saida1">Saída 1:</label>
                            <input type="time" id="saida1">
                        </div>
                        <div class="form-group">
                            <label for="entrada2">Entrada 2 (opcional):</label>
                            <input type="time" id="entrada2">
                        </div>
                        <div class="form-group">
                            <label for="saida2">Saída 2 (opcional):</label>
                            <input type="time" id="saida2">
                        </div>
                    </div>

                    <button type="submit" class="btn">➕ Adicionar Registro</button>
                </form>
            </div>

            <div class="form-section">
                <h2>📋 Registros Recentes</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Funcionário</th>
                                <th>Semana</th>
                                <th>Dia</th>
                                <th>Entrada 1</th>
                                <th>Saída 1</th>
                                <th>Entrada 2</th>
                                <th>Saída 2</th>
                                <th>Extras Entrada</th>
                                <th>Extras Saída</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="registrosRecentes">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ABA RELATÓRIOS -->
        <div id="relatorios" class="tab-content">
            <div class="week-container" id="weekContainer">
                <!-- Semanas serão geradas dinamicamente -->
            </div>

            <div class="form-section">
                <h2>📊 Totais Gerais do Mês</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Funcionário</th>
                                <th>Semana 1</th>
                                <th>Semana 2</th>
                                <th>Semana 3</th>
                                <th>Semana 4</th>
                                <th>Total Mês</th>
                            </tr>
                        </thead>
                        <tbody id="totaisGerais">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados globais
        let registros = [];
        let funcionarios = ['RONALDO', 'JANAINA'];
        let semanas = [1, 2, 3, 4];
        let dias = ['DOMINGO', 'SEGUNDA', 'TERCA', 'QUARTA', 'QUINTA', 'SEXTA', 'SABADO'];

        // Função para mostrar abas
        function showTab(tabName) {
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remover classe active de todos os botões
            document.querySelectorAll('.tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar aba selecionada
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Atualizar dados da aba
            if (tabName === 'painel') {
                atualizarPainel();
            } else if (tabName === 'relatorios') {
                atualizarRelatorios();
            }
        }

        // Função para calcular extras
        function calcularExtras(entrada, saida, isSegundoPeriodo = false) {
            if (!entrada || !saida) return { extraEntrada: 0, extraSaida: 0 };
            
            const [hE, mE] = entrada.split(':').map(Number);
            const [hS, mS] = saida.split(':').map(Number);
            
            const minutosEntrada = hE * 60 + mE;
            const minutosSaida = hS * 60 + mS;
            
            let extraEntrada = 0;
            let extraSaida = 0;
            
            if (!isSegundoPeriodo) {
                // Primeiro período - entrada antes das 8:00 é extra
                if (minutosEntrada < 8 * 60) {
                    extraEntrada = (8 * 60 - minutosEntrada) / 60;
                }
                // Saída depois das 12:00 é extra
                if (minutosSaida > 12 * 60) {
                    extraSaida = (minutosSaida - 12 * 60) / 60;
                }
            } else {
                // Segundo período - entrada antes das 13:00 é extra
                if (minutosEntrada < 13 * 60) {
                    extraEntrada = (13 * 60 - minutosEntrada) / 60;
                }
                // Saída depois das 17:00 é extra
                if (minutosSaida > 17 * 60) {
                    extraSaida = (minutosSaida - 17 * 60) / 60;
                }
            }
            
            return { extraEntrada, extraSaida };
        }

        // Função para formatar horas
        function formatarHoras(horas) {
            const h = Math.floor(Math.abs(horas));
            const m = Math.round((Math.abs(horas) - h) * 60);
            const sinal = horas < 0 ? '-' : '';
            return `${sinal}${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
        }

        // Função para adicionar registro
        document.getElementById('pontoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const funcionario = document.getElementById('funcionario').value;
            const semana = parseInt(document.getElementById('semana').value);
            const dia = document.getElementById('dia').value;
            const entrada1 = document.getElementById('entrada1').value;
            const saida1 = document.getElementById('saida1').value;
            const entrada2 = document.getElementById('entrada2').value;
            const saida2 = document.getElementById('saida2').value;

            const extras1 = calcularExtras(entrada1, saida1, false);
            const extras2 = calcularExtras(entrada2, saida2, true);

            const registro = {
                id: Date.now(),
                funcionario,
                semana,
                dia,
                entrada1,
                saida1,
                entrada2,
                saida2,
                extraEntrada1: extras1.extraEntrada,
                extraSaida1: extras1.extraSaida,
                extraEntrada2: extras2.extraEntrada,
                extraSaida2: extras2.extraSaida,
                totalExtras: extras1.extraEntrada + extras1.extraSaida + extras2.extraEntrada + extras2.extraSaida
            };

            registros.push(registro);
            atualizarRegistrosRecentes();
            atualizarPainel();
            salvarDados();
            
            // Limpar formulário
            this.reset();
            
            alert('Registro adicionado com sucesso!');
        });

        // Função para atualizar registros recentes
        function atualizarRegistrosRecentes() {
            const tbody = document.getElementById('registrosRecentes');
            tbody.innerHTML = '';

            const registrosRecentes = registros.slice(-10).reverse();

            registrosRecentes.forEach(registro => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${registro.funcionario}</td>
                    <td>Semana ${registro.semana}</td>
                    <td>${registro.dia}</td>
                    <td>${registro.entrada1 || '-'}</td>
                    <td>${registro.saida1 || '-'}</td>
                    <td>${registro.entrada2 || '-'}</td>
                    <td>${registro.saida2 || '-'}</td>
                    <td class="status-positive">${formatarHoras(registro.extraEntrada1 + registro.extraEntrada2)}</td>
                    <td class="status-positive">${formatarHoras(registro.extraSaida1 + registro.extraSaida2)}</td>
                    <td><button class="delete-btn" onclick="excluirRegistro(${registro.id})">🗑️</button></td>
                `;
            });
        }

        // Função para excluir registro
        function excluirRegistro(id) {
            if (confirm('Tem certeza que deseja excluir este registro?')) {
                registros = registros.filter(r => r.id !== id);
                atualizarRegistrosRecentes();
                atualizarPainel();
                atualizarRelatorios();
                salvarDados();
            }
        }

        // Função para atualizar painel
        function atualizarPainel() {
            // Total de extras do mês
            const totalExtras = registros.reduce((sum, r) => sum + r.totalExtras, 0);
            document.getElementById('totalExtrasMes').textContent = formatarHoras(totalExtras);
            
            // Registros de hoje
            const hoje = new Date().toDateString();
            const registrosHoje = registros.filter(r => new Date(r.timestamp || Date.now()).toDateString() === hoje).length;
            document.getElementById('registrosHoje').textContent = registrosHoje;

            // Resumo por funcionário
            const tbody = document.getElementById('resumoFuncionarios');
            tbody.innerHTML = '';

            funcionarios.forEach(func => {
                const registrosFunc = registros.filter(r => r.funcionario === func);
                const totalExtrasFunc = registrosFunc.reduce((sum, r) => sum + r.totalExtras, 0);
                const horasTrabalhadas = registrosFunc.length * 8; // Estimativa
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${func}</td>
                    <td>${horasTrabalhadas}:00</td>
                    <td class="status-positive">${formatarHoras(totalExtrasFunc)}</td>
                    <td class="status-negative">0:00</td>
                    <td class="status-positive">${formatarHoras(totalExtrasFunc)}</td>
                `;
            });
        }

        // Função para atualizar relatórios
        function atualizarRelatorios() {
            const container = document.getElementById('weekContainer');
            container.innerHTML = '';

            semanas.forEach(semana => {
                const weekCard = document.createElement('div');
                weekCard.className = 'week-card';
                
                let weekContent = `
                    <div class="week-header">SEMANA ${semana}</div>
                    <div class="week-content">
                `;

                funcionarios.forEach(func => {
                    const registrosSemana = registros.filter(r => r.funcionario === func && r.semana === semana);
                    const totalExtrasSemana = registrosSemana.reduce((sum, r) => sum + r.totalExtras, 0);

                    weekContent += `
                        <div class="funcionario-section">
                            <div class="funcionario-name">${func}</div>
                            <div class="day-entry header">
                                <div>Dia</div>
                                <div>Entrada</div>
                                <div>Saída</div>
                                <div>Extras</div>
                            </div>
                    `;

                    dias.forEach(dia => {
                        const registro = registrosSemana.find(r => r.dia === dia);
                        if (registro) {
                            weekContent += `
                                <div class="day-entry">
                                    <div>${dia.substring(0, 3)}</div>
                                    <div>${registro.entrada1 || '-'}</div>
                                    <div>${registro.saida1 || '-'}</div>
                                    <div class="status-positive">${formatarHoras(registro.totalExtras)}</div>
                                </div>
                            `;
                        }
                    });

                    weekContent += `
                            <div class="totals-section">
                                <div class="total-item total-extras">
                                    <span>TOTAL EXTRAS:</span>
                                    <span>${formatarHoras(totalExtrasSemana)}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });

                weekContent += '</div>';
                weekCard.innerHTML = weekContent;
                container.appendChild(weekCard);
            });

            // Atualizar totais gerais
            const tbody = document.getElementById('totaisGerais');
            tbody.innerHTML = '';

            funcionarios.forEach(func => {
                const row = tbody.insertRow();
                let totalMes = 0;
                let rowContent = `<td>${func}</td>`;

                semanas.forEach(semana => {
                    const registrosSemana = registros.filter(r => r.funcionario === func && r.semana === semana);
                    const totalSemana = registrosSemana.reduce((sum, r) => sum + r.totalExtras, 0);
                    totalMes += totalSemana;
                    rowContent += `<td class="status-positive">${formatarHoras(totalSemana)}</td>`;
                });

                rowContent += `<td class="status-positive" style="font-weight: bold; font-size: 1.1em;">${formatarHoras(totalMes)}</td>`;
                row.innerHTML = rowContent;
            });
        }

        // Função para salvar dados
        function salvarDados() {
            localStorage.setItem('bancoHorasCompleto', JSON.stringify(registros));
        }

        // Função para carregar dados
        function carregarDados() {
            const dadosSalvos = localStorage.getItem('bancoHorasCompleto');
            if (dadosSalvos) {
                registros = JSON.parse(dadosSalvos);
                atualizarRegistrosRecentes();
                atualizarPainel();
            }
        }

        // Inicializar sistema
        document.addEventListener('DOMContentLoaded', function() {
            carregarDados();
            atualizarPainel();
            
            // Auto-salvar a cada 30 segundos
            setInterval(salvarDados, 30000);
        });
    </script>
</body>
</html>